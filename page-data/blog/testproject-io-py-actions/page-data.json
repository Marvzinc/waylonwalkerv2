{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/testproject-io-py-actions/","result":{"data":{"markdownRemark":{"id":"c8ab6157-d8dc-57f9-883c-d469ce9c5380","html":"<p>As I continue to build out <a href=\"https://waylonwalker.com/\">waylonwalker.com</a> I sometimes run into some errors that are not caught becuase I do not have good testing implemented.  I want to explore some integration testing options using GitHub actions.</p>\n<p>Running integration tests will not prevent bugs from happening completely, but it will allow me to quickly spot them and roll back.</p>\n<h2>ðŸ¤” What to test first?</h2>\n<p>The very first thing that comes to my mind is anything that is loaded or ran client side.  Two things quickly came to mind here.  I run gatsby so most of my content is statically rendered, and it yells at me if something isn't as expected.  For performance reasons I lazy load cards on my blogroll, loading all of the header images gets heavy and kills lighthouse (if anyone actually cares). I am also loading some information from my top open source libraries that I have created.  To prevent the need to rebuild the whole site to get the latest information I am just using the GitHub api client side.</p>\n<ul>\n<li>lazy loaded blog cards</li>\n<li>GitHub repos</li>\n</ul>\n<p>I chose to start with the GitHub repos as they seemed a bit more straight forward, and it's been awhile since I have done any selenium.</p>\n<p><img src=\"https://waylonwalker.com/open-source-cards.png\" alt=\"Open Source cards as they look on waylonwalker.com\"></p>\n<blockquote>\n<p>here is what the GitHub repo cards look like</p>\n</blockquote>\n<h2>TestProject.io</h2>\n<p>I am trying out <a href=\"https://TestProject.io\">TestProject.io</a> for the first time on this project.  My experience so far has been top notch.  There was an existing suite of docker images/files setup to run the TestProject agent in a docker container alongside of headless chrome and firefox drivers.  The first thing that you are going to need are a <a href=\"https://app.TestProject.io/#/integrations/sdk\">TP_DEV_TOKEN </a> and <a href=\"https://app.TestProject.io/#/integrations/api\">TP_API_KEY</a>.  These will give TestProject access to your account so that it can automatically post results to your <a href=\"https://app.TestProject.io/#/reports\">dashboard</a></p>\n<ul>\n<li><a href=\"https://app.TestProject.io/#/integrations/sdk\">TP_DEV_TOKEN </a></li>\n<li><a href=\"https://app.TestProject.io/#/integrations/api\">TP_API_KEY</a></li>\n</ul>\n<h3>Put these in secrets in your repo</h3>\n<p>In your GitHub repo go to <code class=\"language-text\">settings&gt;Secrets</code>, or append <code class=\"language-text\">settings/secrets</code> to the url to your repo, and add the tokens.  This will give GitHub safe access to them without them being available to the public, contributors, log files, or anything.</p>\n<p><img src=\"https://waylonwalker.com/test-waylonwalker-com-secrets.png\" alt=\"Secrets panel in the GitHub Repo\"></p>\n<h3><a href=\"https://forum.TestProject.io/t/install-agent-inside-github-actions/2334/3\">Forum</a></h3>\n<h2>Setup Dev</h2>\n<p>To expedite developemnt I went ahead and setup development environment that I could log into on Digital Ocean.  This allowed me to get all of my tests working a bit quicker than just running them through GitHub, but being as similar as possible.  This allowed me to learn the ins and outs of setting up TestProject without needing to do a full install everytime through github actions.</p>\n<p><a href=\"https://waylonwalker.com/notes/new-machine-tpio\"><img src=\"https://waylonwalker.com/new-machine-tpio.png\" alt=\"Test Project Dev Machine setup notes card\"></a></p>\n<blockquote>\n<p>I am not going to go into full dev machine setup here, but you can read my <a href=\"https://waylonwalker.com/notes/new-machine-tpio\">setup notes</a>.</p>\n</blockquote>\n<h3><a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/tree/master/tests\">pytest</a></h3>\n<p><em>you can see my full results on <a href=\"https://github.com/waylonwalker/waylonwalker-com-tests/tree/master/tests\">github.com/waylonwalker/waylonwalker-com-tests</a></em></p>\n<p>I chose to go down the route of using pytest.  I really liked the idea of utilizing fixtures, automatically running my test functions, and utilizing a bit of the pytest reporting capabilities.</p>\n<p><strong>NOTE</strong> per pytest standard practice I named the directory containing tests <code class=\"language-text\">tests</code>.  While this works, TestProject.io uses this director as the default name for the project.  If I were to go back I would either rename the directory to what I want to show up on TestProject.io or configure the project name inside of the config.</p>\n<h3><a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/blob/master/tests/conftest.py\">conftest.py</a></h3>\n<p>pytest automatically imports <a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/blob/master/tests/conftest.py\">conftest.py</a> modules from the same directory that you are working from.  It's common to place fixtures used accross multiple files here.  I placed a driver fixture in this module so that as I create more tests it will be available everywhere by default.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># tests/conftest.py</span>\n\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> pytest\n<span class=\"token keyword\">from</span> src<span class=\"token punctuation\">.</span>TestProject<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>drivers <span class=\"token keyword\">import</span> webdriver\n\n<span class=\"token decorator annotation punctuation\">@pytest<span class=\"token punctuation\">.</span>fixture</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">driver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token string\">\"creates a webdriver and loads the homepage\"</span>\n    driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Chrome<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"https://waylonwalker.com/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">yield</span> driver\n    driver<span class=\"token punctuation\">.</span>quit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>Look at the full version of <a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/blob/master/tests/conftest.py\">conftest.py</a></p>\n</blockquote>\n<p>The above sample is a bit <strong>simplified</strong>.  I ran into some inconsistencies in the real version and found that some tests had a better pass rate if I added a wait.  I eneded up with a <code class=\"language-text\">driver</code> and a <code class=\"language-text\">slow_driver</code> fixture.</p>\n<h3><a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/blob/master/tests/test_repos.py\">test_repos</a></h3>\n<p>I have initially setup 3 different tests for the repo cards.  I set a list of repos that I expect to show up in the cards.  These tests are quite easy to do with TestProject.io as it is using selenium and a headless browser to execute javascript under the hood.</p>\n<p>If you are not familiar a <strong>headless browser</strong> runs the engine as your browser without a graphical user interface.  JavaScript gets fully loaded and parsed, and the dom is completely interactive programatically.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token triple-quoted-string string\">\"\"\"\nTest that GitHub repo data dynamically loads client side.\n\"\"\"</span>\n\nREPOS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"find-kedro\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"kedro-static-viz\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"kedro-action\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"steel-toes\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_repos_loaded</span><span class=\"token punctuation\">(</span>slow_driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Test that the each repo-name exists as a title in one of the repo cards.\n\n    On waylonwalker.com repo cards have a title with a class of \"repo-name\"\n    \"\"\"</span>\n    repos <span class=\"token operator\">=</span> slow_driver<span class=\"token punctuation\">.</span>find_elements_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"repo-name\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># get innertext from elements</span>\n    header_text <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        header<span class=\"token punctuation\">.</span>text <span class=\"token keyword\">for</span> header <span class=\"token keyword\">in</span> repos\n    <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> repo <span class=\"token keyword\">in</span> REPOS<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">assert</span> repo <span class=\"token keyword\">in</span> header_text\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_repo_description_loaded</span><span class=\"token punctuation\">(</span>slow_driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Test that each repo has a description longer than 10 characters\n\n    On waylonwalker.com repo cards have a descriptiion with a class of \"repo-description\"\n    \"\"\"</span>\n    repo_elements <span class=\"token operator\">=</span> slow_driver<span class=\"token punctuation\">.</span>find_elements_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"repo\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> el <span class=\"token keyword\">in</span> repo_elements<span class=\"token punctuation\">:</span>\n        desc <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"repo-description\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>desc<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">10</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_repo_stars_loaded</span><span class=\"token punctuation\">(</span>slow_driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Ensure that stars are properly parsed from the api and loaded client side\n\n    On waylonwalker.com repo cards have a stars element with a class of \"repo-stars\" and\n    is displayed as \"n stars\"\n    \"\"\"</span>\n    repo_elements <span class=\"token operator\">=</span> slow_driver<span class=\"token punctuation\">.</span>find_elements_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"repo\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> el <span class=\"token keyword\">in</span> repo_elements<span class=\"token punctuation\">:</span>\n        stars <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>find_element_by_class_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"repo-stars\"</span><span class=\"token punctuation\">)</span>\n        num_stars<span class=\"token punctuation\">,</span> label <span class=\"token operator\">=</span> stars<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>num_stars<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">assert</span> label <span class=\"token operator\">==</span> <span class=\"token string\">'stars'</span></code></pre></div>\n<h2><a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/blob/master/.github/workflows/test-waylonwalker-com.yml\">GitHub Actions</a></h2>\n<h3><a href=\"https://github.com/WaylonWalker/waylonwalker-com-tests/blob/master/.github/ci/docker-compose.yml\">docker-compose.yml</a></h3>\n<h2>TestProject.io Dashboard</h2>\n<p><img src=\"https://waylonwalker.com/tpio-test-repos.png\" alt=\"My Dashboard for test_repos\"></p>","fields":{"slug":"/blog/testproject-io-py-actions/"},"frontmatter":{"date":"2020-07-27T05:00:00.000Z","devto_url":"","devto_id":"","title":"Integration testing with Python, TestProject.io, and GitHub Actions","description":"As I continue to build out https://waylonwalker.com/ I sometimes run into some errors that are not caught becuase I do not have good testing implemented. I want to explore some integration testing options using GitHub actions.","path":"testproject-io-py-actions","twitter_cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/testproject-io-py-actions.png","childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABk0lEQVQY02WPX2vTUBiHc+P1ULouabq2SZq0Nee85z05Wf6nbZoZXLs6OiZDxsYoRZlOZaJsIFjRC7+BF35aD6sIIjxXLzy/h1dpdPmGHQMMN1y+url6d7v+9iUdD/sMRRQAT5JoTGBIIacspSyhGFOMAANlY2oWSnTbMyDSB95slhwt9mbzaPmiKsro9HhyL2fwv7wxZdlk8Xm1nNCDB5rTt3LhPNlqotYR3V7usQIgJ/CvLDXVYloXGybftqDkh+vxhzfZ6ufB1/Xk5nW6+jS6/lHd3U7efi7fX2RnNvUZJn9k1UTdEKrB5YSMayZCP09IBU7a7vi+HQkn3eezkZhW/jwX1QBCghHBEHigAHq/Pl4/808eth43LKybUDeoQ2Mzm4fVtLm/qgUnO+xpn+YuZISlgg89nvkioyxUHBfuLqeFXzxqU03GTdawOPby6nB69bLsPv+ux6dNf7E7iF033eNF6pWxVwQ4atmeUjfYVtOtdYhqsr/ICbVDai1S1221PVANKj+S7Nq83RO6jdv3l99nzGH0h2EhOwAAAABJRU5ErkJggg==","width":800,"height":418,"src":"/static/28eb6d01ed1ac83291370061f8c0efc6/267c5/testproject-io-py-actions.png","srcSet":"/static/28eb6d01ed1ac83291370061f8c0efc6/267c5/testproject-io-py-actions.png 1x"}}},"cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/testproject-io-py-actions.png","childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABk0lEQVQY02WPX2vTUBiHc+P1ULouabq2SZq0Nee85z05Wf6nbZoZXLs6OiZDxsYoRZlOZaJsIFjRC7+BF35aD6sIIjxXLzy/h1dpdPmGHQMMN1y+url6d7v+9iUdD/sMRRQAT5JoTGBIIacspSyhGFOMAANlY2oWSnTbMyDSB95slhwt9mbzaPmiKsro9HhyL2fwv7wxZdlk8Xm1nNCDB5rTt3LhPNlqotYR3V7usQIgJ/CvLDXVYloXGybftqDkh+vxhzfZ6ufB1/Xk5nW6+jS6/lHd3U7efi7fX2RnNvUZJn9k1UTdEKrB5YSMayZCP09IBU7a7vi+HQkn3eezkZhW/jwX1QBCghHBEHigAHq/Pl4/808eth43LKybUDeoQ2Mzm4fVtLm/qgUnO+xpn+YuZISlgg89nvkioyxUHBfuLqeFXzxqU03GTdawOPby6nB69bLsPv+ux6dNf7E7iF033eNF6pWxVwQ4atmeUjfYVtOtdYhqsr/ICbVDai1S1221PVANKj+S7Nq83RO6jdv3l99nzGH0h2EhOwAAAABJRU5ErkJggg==","width":1000,"height":420,"src":"/static/28eb6d01ed1ac83291370061f8c0efc6/a8734/testproject-io-py-actions.png","srcSet":"/static/28eb6d01ed1ac83291370061f8c0efc6/a8734/testproject-io-py-actions.png 1x"},"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABk0lEQVQY02WPX2vTUBiHc+P1ULouabq2SZq0Nee85z05Wf6nbZoZXLs6OiZDxsYoRZlOZaJsIFjRC7+BF35aD6sIIjxXLzy/h1dpdPmGHQMMN1y+url6d7v+9iUdD/sMRRQAT5JoTGBIIacspSyhGFOMAANlY2oWSnTbMyDSB95slhwt9mbzaPmiKsro9HhyL2fwv7wxZdlk8Xm1nNCDB5rTt3LhPNlqotYR3V7usQIgJ/CvLDXVYloXGybftqDkh+vxhzfZ6ufB1/Xk5nW6+jS6/lHd3U7efi7fX2RnNvUZJn9k1UTdEKrB5YSMayZCP09IBU7a7vi+HQkn3eezkZhW/jwX1QBCghHBEHigAHq/Pl4/808eth43LKybUDeoQ2Mzm4fVtLm/qgUnO+xpn+YuZISlgg89nvkioyxUHBfuLqeFXzxqU03GTdawOPby6nB69bLsPv+ux6dNf7E7iF033eNF6pWxVwQ4atmeUjfYVtOtdYhqsr/ICbVDai1S1221PVANKj+S7Nq83RO6jdv3l99nzGH0h2EhOwAAAABJRU5ErkJggg==","aspectRatio":2.380952380952381,"src":"/static/28eb6d01ed1ac83291370061f8c0efc6/a8734/testproject-io-py-actions.png","srcSet":"/static/28eb6d01ed1ac83291370061f8c0efc6/2d6f8/testproject-io-py-actions.png 250w,\n/static/28eb6d01ed1ac83291370061f8c0efc6/03ac3/testproject-io-py-actions.png 500w,\n/static/28eb6d01ed1ac83291370061f8c0efc6/a8734/testproject-io-py-actions.png 1000w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"c8ab6157-d8dc-57f9-883c-d469ce9c5380"}}}